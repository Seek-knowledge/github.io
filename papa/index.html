<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<title>啪仙拜年</title>
</head>
<link rel="stylesheet" href="papa.css">
<!-- <script src="papa.js"></script> -->
<body>
	<!-- <audio src="mu00.mp3" display='hidden'></audio> -->
	<!-- 加载页面 theLoading-->
	<section class="theLoading" id="theLoading">
		<div class="banner">
			<img src="imgs/logo.png" alt="文字：赤尾">
		</div>
		<div class="man">
			<img src="imgs/loding.png" alt="人物：老汉" class="oldMan">
			<img src="imgs/loding2.png" alt="物体：白云" class="cloud">
		</div>
		<h2>Loading...<br/><span id="loadnum">0</span></h2>
	</section>
	<!-- 何仙姑开始抽排界面 -->
	<section class="heXianGu" id="heXianGu"> 
		<div class="banner">
			<img src="imgs/logo.png" alt="文字：赤尾">
		</div>
		<div class="men">
			<img src="imgs/scene01_1.png" alt="何仙姑和童子" id="men">
		</div>
		<img src="imgs/scene01_02.png" alt="抽出我的啪啪牌" class="papapai">
		<img src="imgs/scene01_start.png" alt="开始抽牌" id="kaishichoupai">
	</section>
	<!-- 开始洗牌 -->
	<section class="xipai" id="xipai" alt="洗牌">
		<div class="banner">
			<img src="imgs/logo.png" alt="文字：赤尾">
		</div>
		<img src="imgs/pa01.png" alt="一张显示叠在一起的牌" class="paiinal" id="paiinal">
		<img src="imgs/pa03.png" alt="开始洗牌btn" class="xipaibtn" id="xipaibtn">
		<img src="imgs/font_top.png" alt="选牌提示" id="xuanpaitishi">
		<img src="imgs/scene03_btn.png" alt="图文解释" id="tuwenbtn">
		<img src="imgs/hand02.png" alt="选牌手" id="xuanpaihand">
		<img src="imgs/scene03_tit01.png" alt="闪现的彩色票" id="tit01">
		<img src="imgs/scene03_tit02.png" alt="闪现的彩色票" id="tit02">
		<img src="imgs/scene03_tit03.png" alt="闪现的彩色票" id="tit03">
		<img src="imgs/scene03_tit04.png" alt="闪现的彩色票" id="tit04">
	</section>
	<!-- 牌文解析 -->
	<section class="paiwenjiexi" id="paiwenjiexi">
		<img src="imgs/scene04_02.png" alt="" id="menlast">
		<div id="choose">
			<img src="imgs/scene04_share.png" alt="分享给啪友" id="choosel">
			<img src="imgs/scene04_again.png" alt="再玩一次" id="chooser">
		</div>
		<div id="themove">
			<img src="imgs/scene_r.png" alt="右侧棒子" class="themover">
			<img src="imgs/scene04_01_2.png" alt="左侧套套" class="themovel" id="themovel">
		</div>
	</section>
	<!-- xipaibtn  paiinal-->
</body>
<script>
// animation
	var imgs=document.getElementsByTagName("img");
	var loadnum=document.getElementById("loadnum");
	var theLoading=document.getElementById("theLoading");
	var heXianGu=document.getElementById("heXianGu");
	var kaishichoupai=document.getElementById("kaishichoupai");
	var xuanpaitishi=document.getElementById("xuanpaitishi");
	var xuanpaihand=document.getElementById("xuanpaihand");

	var tuwenbtn=document.getElementById("tuwenbtn");
	var tit01=document.getElementById("tit01");
	var tit02=document.getElementById("tit02");
	var tit03=document.getElementById("tit03");
	var tit04=document.getElementById("tit04");
	var menlast=document.getElementById("menlast");
	var paiwenjiexi=document.getElementById("paiwenjiexi");
	var choose=document.getElementById("choose");
	var choosel=document.getElementById("choosel");
	var chooser=document.getElementById("chooser");

	var themove=document.getElementById("themove");
	var themovel=document.getElementById("themovel");
	// var chooser=document.getElementById("chooser");
	window.onload=function(){
		setTimeout(function(){
			for(var i=0;i<imgs.length;i++){
				loadnum.innerHTML=Math.floor((i+1)/imgs.length*100)+"%";
				console.log(imgs.length+";"+(i+1));
			}
		}, 1000)
		setTimeout(function(){
			theLoading.style.display="none";
			heXianGu.style.display="block";
		}, 2000)
	}
	// // 影藏theLoading
	// theLoading.style.display="none";
	// 何仙姑动画部分
	var men=document.getElementById("men");
	var i=1;
	var timer=setInterval(function(){
			men.src="imgs/scene01_"+i+".png";
			i++;
			if(i>12){
				i=1;
			}
	},100)
	// 显示何仙姑
	// heXianGu.style.display="none";
	// 隐藏何仙姑，展现洗牌界面
	kaishichoupai.onclick=function(){
		heXianGu.style.display="none";
		xipai.style.display="block";
	}
	// 开始洗牌部分
	var xipai=document.getElementById("xipai");
		// 一张显示叠在一起的牌
	var paiinal=document.getElementById("paiinal");
		// 开始洗牌btn
	var xipaibtn=document.getElementById("xipaibtn");
		// 创建数组存牌
	var _imgpai=[];
	xipaibtn.onclick=function(){
		paiinal.style.transform="scale(0.5)";
		paiinal.style.opacity="0";
		setTimeout(function(){
        	paiinal.style.display="none";
        	// =====
        	for(var i=0;i<8;i++){
        		_imgpai[i]=document.createElement("img");
        		_imgpai[i].className="xipailei";
	        	_imgpai[i].setAttribute("src","imgs/pa02.png");
	        	xipai.appendChild(_imgpai[i]);
        		for(var j=0;j<8;j++){
	        		// changepai(k);
	        		// for循环瞬间触发所有循环内的满足条件，所以前后两次settimeout的数值差才是前后两次动作的间隔时间
	        		var a=j*1000+2000;
	        		setTimeout(function(k){changepai(k)},a,_imgpai[i]);
	        		console.log("a是循环内的settimeout时间:"+a);
        		}

        		//八牌复原方法一==============
        		// (function(i,k){
        		// 	var b=10000+i*500;
        		// 	setTimeout(function(c){fuyuanpai(c)},b,k)
        		// 	console.log("b"+b)
        		// })(i,_imgpai[i]);
				// 八牌复原方法二==============
        		var b=10000+i*100;
        		setTimeout(function(k){fuyuanpai(k);},b,_imgpai[i]);
        		console.log("b外面:"+b);
       			    	
       			setTimeout(function(k1){fuyuanpai(k1)},13500,_imgpai[i]);  	
        	}
        	
		},1500);
		shuapaitwice(2);
		shuapaitwice(5);
		xipaibtn.style.display="none";
		//上部分的延迟时间到16000ms
		// alert("1");
		setTimeout(function(){showxuanpaitishi();},17000);
	}

	// 八张牌的旋转
		function changepai(arrayobj){
		 var _x=Math.floor(Math.random()*200)-100;
		 var _y=Math.floor(Math.random()*400)-100;
		 var _ro=Math.floor(Math.random()*620)-360;
		arrayobj.style.transform="translate("+_x+"px,"+_y+"px) rotate("+_ro+"deg)";
	}	
	//八张牌复原
	function fuyuanpai(arrayobj){
		console.log("激活fuyuanpai程序"+arrayobj);
		arrayobj.style.transform="translate(0px,0px) rotate(0deg)";

		// setTimeout(function(){
		// 	alert("复原后刷牌")
		// 	// arrayobj.style.transform-origin="center bottom";
		// 	for(var i=0;i<_imgpai.length;i++){
		// 		arrayobj.style.transform="rotate("+(i*13-90)+"deg)";
		// 	}
		// },500)
	} 
	// 刷牌两次
	function shuapaitwice(i){
		setTimeout(function(){
			shuapai();
		},11000+i*1000);
	}
	//刷牌单次数据
	function shuapai(){
		for(var i=0;i<_imgpai.length;i++){
			_imgpai[i].style.transformOrigin="50% 150%";
			_imgpai[i].style.transform="rotate("+(i*15-50)+"deg)";
			// console.log("_imgpai["+i+"].style.transform:"+_imgpai[i].style.transform+";_imgpai["+i+"].style.transformOrigin:"+_imgpai[i].style.transformOrigin);
		}
	}
	// 洗牌两次后出现选择滑动提示
	function showxuanpaitishi(){
		xuanpaitishi.style.display="block";
		xuanpaihand.style.display="block";
		xuanpaihand.style.webkitAnimation="handup 2s forwards 1s";
		// 循环选择牌,要放在循环生成img数组的局部函数内，否则浏览器按顺序下来，则点击事件先于数组生成发生，则不能点击无效果
		touchpai();
		// alert("1");
		function touchpai(){
			// var e;
			for(var j=0;j<_imgpai.length;j++){
			(function(k){
				_imgpai[k].onclick=function(){
					for(var e=0;e<_imgpai.length;e++){
						setTimeout(function(e){
							_imgpai[e].style.transition="all 1s";
							_imgpai[e].style.opacity="0";
							_imgpai[k].style.opacity="1";
							console.log("k:"+k);
							_imgpai[e].style.display="none";
							// _imgpai[k].style.transformOrigin="50% 150%";
							_imgpai[k].style.transform="perspective(600px)" ;
							// _imgpai[k].style.transform="perspective(600px) translateY(0px) rotateY(180deg) scale(2)";
							_imgpai[k].style.display="block";
							_imgpai[k].style.transform="translate(0px,-50px) rotate("+(k*15-50)+"deg)";
							
							// console.log("rotate("+(k*15-50)+"deg)"+(k*15-50));
							setTimeout(function(){
								_imgpai[k].style.transformOrigin="50% 50%";
								_imgpai[k].style.webkitAnimation="paiupandshow 3s forwards 0s 1"},1000);
								setTimeout(function(){_imgpai[k].setAttribute("src","imgs/scene03_img0"+zhongzhuang()+".png");},3500)
							},500,e)
					}
					// 抽牌提示消失
					colorpapershowup();
					_imgpai[k].onclick=null;
				}
			})(j);
			// alert("e()"+e());
		}
		}
	}
	function colorpapershowup(){
		// alert("3");
		xuanpaitishi.style.display="none";
		// 延迟图文按钮出现时间
		setTimeout(function(){tuwenbtn.style.display="block";},5000)

		setTimeout(function(){
			tit01.style.display="block";
			tit02.style.display="block";
			tit03.style.display="block";
			tit04.style.display="block";
		},4000)
		tit01.style.webkitAnimation="titnone 5s forwards 1s"
		tit02.style.webkitAnimation="titnone 5s forwards 1s"
		tit03.style.webkitAnimation="titnone 5s forwards 1s"
		tit04.style.webkitAnimation="titnone 5s forwards 1s"
		setTimeout(function(){
			tit01.style.display="none";
			tit02.style.display="none";
			tit03.style.display="none";
			tit04.style.display="none";
		},9000)		
	}
	// 选择要图解的牌下标
	function choupai(){
		var a=Math.floor(Math.random()*8+1);
		return a;
	}
	function zhongzhuang(){
		var b=choupai();
		changemenlast(b);
		taotaosrc(b);
		console.log("b:"+b);
		return b;		
	}
	function changemenlast(b){
		console.log("b:"+b);
		menlast.setAttribute("src","imgs/scene04_0"+b+".png");
	}
	// 图文解释按钮跳转图文解释界面
	tuwenbtn.onclick=function(){
		xipai.style.display="none";
		paiwenjiexi.style.display="block";
		taotaoshow();
	}
	choosel.onclick=function(){

	}
	// 清除_imgpai数组内的图片
	function qingchu_imgpai(){
		for(var i=0;i<_imgpai.length;i++){
			xipai.removeChild(_imgpai[i]);
		}
		// 清除彩色纸片
		tit01.style.display="none";
		tit02.style.display="none";
		tit03.style.display="none";
		tit04.style.display="none";
		// 显示大图片
		paiinal.style.transform="scale(1)";
		paiinal.style.opacity="1";
		paiinal.style.display="block";
	}
	chooser.onclick=function(){
		xipai.style.display="block";
		paiwenjiexi.style.display="none";
		xipaibtn.style.display="block";
		tuwenbtn.style.display="none";
		xuanpaihand.style.display="none";
		qingchu_imgpai();
		// 套套消失
		themove.style.display="none";
	}
	// 套套换装
	function taotaosrc(b){
		themovel.setAttribute("src","imgs/scene04_0"+b+"_2.png");

	}
	// 套套出现
	function taotaoshow(){
		themove.style.display="block";
		themovel.style.webkitAnimation="taotaoup 2s forwards 0s";
	}
</script>
</html>